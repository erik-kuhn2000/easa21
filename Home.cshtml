@page
@model HomeModel
@using Microsoft.AspNetCore.Authorization
@inject IAuthorizationService AuthorizationService
@{
    ViewData["Title"] = "Home";
   
}
@{
    var isAuthorizedUser = (await AuthorizationService.AuthorizeAsync(User, "SignatoryRoleRequired")).Succeeded;
    var isAdmin = (await AuthorizationService.AuthorizeAsync(User, "AdminOnly")).Succeeded;
}
<div class="container-fluid">

    <h1 class="page-title">EASA21 Manual Release Tool</h1>
    <p class="subtitle">Choose from the actions below.</p>

    <div class="d-flex flex-column gap-3">
        <a class="btn btn-primary btn-update text-center" asp-page="/SearchCertificate">
            <i class="fas fa-search btn-icon"></i>
            <span>Search Entry</span>
        </a>

        @if (isAuthorizedUser)
        {
            <a class="btn btn-add text-center" asp-page="/AddCertificate">
                <i class="fas fa-plus btn-icon"></i>
                <span>Add New Entry</span>
            </a>
        }
    </div>

    <br>

    @if (isAdmin)
                        {
    <div class="card mb-4">
        <div class="card-header bg-light d-flex justify-content-between align-items-center"
             style="cursor: pointer;"
             data-bs-toggle="collapse"
             data-bs-target="#adminToolsCollapse"
             aria-expanded="false"
             aria-controls="adminToolsCollapse">
            <h5 class="mb-0"><i class="fas fa-wrench btn-icon me-2"></i>Admin Tools</h5>
            <i class="fas fa-chevron-down collapse-icon"></i>
        </div>

        
        <div class="collapse" id="adminToolsCollapse">
           

            <div class="card-body border-bottom">
                <div class="row row-cols-1 row-cols-md-2 g-3">
                    <div class="col">
                        <a class="btn action-btn-slate w-100" asp-page="/ManagePartNumbers">
                            <i class="fas fa-barcode btn-icon"></i>
                            <span>Manage Part Numbers</span>
                        </a>
                    </div>
                    <div class="col">
                        <a class="btn action-btn-slate w-100" asp-page="/ManagePrefixes">
                            <i class="fas fa-calendar btn-icon"></i>
                            <span>Manage Prefixes</span>
                        </a>
                    </div>
                    <div class="col">
                        <a class="btn action-btn-slate w-100" asp-page="/ManageAmendments">
                            <i class="fas fa-stamp btn-icon"></i>
                            <span>Manage Amendments</span>
                        </a>
                    </div>
                    <div class="col">
                        <a class="btn action-btn-slate w-100" asp-page="/ManageStatuses">
                            <i class="fas fa-info btn-icon"></i>
                            <span>Manage Statuses</span>
                        </a>
                    </div>
                        <!-- <div class="col">
                            <a class="btn action-btn-slate w-100" asp-page="/ManageApprovedDesignIndicators">
                                <i class="fas fa-check-circle btn-icon"></i>
                                <span>Manage Approved Design Indicators</span>
                            </a>
                        </div>
                        <div class="col">
                            <a class="btn action-btn-slate w-100" asp-page="/ManageStates">
                                <i class="fas fa-traffic-light btn-icon"></i>
                                <span>Manage States</span>
                            </a>
                        </div> -->
                        <div class="col">
                            <a class="btn action-btn-slate w-100" asp-page="/ManageAuthorisationNumber">
                                <i class="fas fa-id-card btn-icon"></i>
                                <span>Manage Authorisation Number</span>
                            </a>
                        </div>
                </div>
            </div>

            <div class="card-body border-bottom">
                <div class="row g-3">
                        <div class="col-md-6">
                        <a class="btn action-btn-slate w-100" asp-page="/ManageUsers">
                            <i class="fas fa-user-pen btn-icon"></i>
                            <span>Manage Users</span>
                        </a>
                    </div>
                  
                </div>
            </div>

            <div class="card-body border-bottom">
                <div class="row g-3">
                    <div class="col-md-6">
                        <a class="btn action-btn-slate w-100" asp-page="/UploadTemplate">
                            <i class="fas fa-upload btn-icon"></i>
                            <span>Upload Template</span>
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="#" class="btn action-btn-slate w-100" onclick="downloadTemplate(event)">
                            <i class="fas fa-download btn-icon"></i>
                            <span>Download Template</span>
                        </a>
                    </div>
                </div>
            </div>

            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                            <a class="btn action-btn-slate w-100" asp-page="/DownloadLogs">
                            <i class="fas fa-file-alt btn-icon"></i>
                            <span>Download Logs</span>
                        </a>
                    </div>
                    
                </div>
            </div>
        </div>
       
    </div>
    }
</div>


@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
       
            // Handle the expand/collapse icon for the Admin Tools card
            const adminToolsCollapse = document.getElementById('adminToolsCollapse');
            const adminToolsIcon = document.querySelector('[data-bs-target="#adminToolsCollapse"] .collapse-icon');
           if (adminToolsCollapse && adminToolsIcon) {
                adminToolsCollapse.addEventListener('show.bs.collapse', () => adminToolsIcon.classList.replace('fa-chevron-down', 'fa-chevron-up'));
                adminToolsCollapse.addEventListener('hide.bs.collapse', () => adminToolsIcon.classList.replace('fa-chevron-up', 'fa-chevron-down'));
            }
        });

        // Display success messages passed via TempData
        @if (!string.IsNullOrEmpty(Model.SuccessMessage))
        {
                <text>
                document.addEventListener('DOMContentLoaded', function() {
                    // Assumes you have a global showSuccessMessage function, e.g., in _Layout.cshtml
                    if (typeof showSuccessMessage === 'function') {
                        showSuccessMessage('@Html.Raw(Model.SuccessMessage)');
                    }
                });
                </text>
        }
    </script>
}